AWSTemplateFormatVersion: "2010-09-09"
# Transform is a macro developed by aws, takes entire template written in SAM syntax and transforms and expands into CFN
Transform: "AWS::Serverless-2016-10-31" 


Parameters:
  UserPoolName: 
    Type: String
    Description: Enter the user pool name that you want to create.
  DeploymentEnvironment:
    Type: String
    Description: Stage in which the Api's need to be deployed

Resources:
  FitnessApiGateWay:
    Type: AWS::Serverless::Api
    Properties:
      StageName: !Ref DeploymentEnvironment
      Auth:
        DefaultAuthorizer: MyCognitoAuth
        Authorizers:
          MyCognitoAuth:
            UserPoolArn: !GetAtt CognitoUserPool.Arn

  MyFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: src
      Handler: app.lambda_handler
      Runtime: python3.9
      Events:
        Root:
          Type: Api
          Properties:
            RestApiId: !Ref FitnessApiGateWay
            Path: /
            Method: GET

  CognitoUserPool:
    Type: AWS::Cognito::UserPool
    Properties: 
      UserPoolName: !Ref UserPoolName
      UsernameAttributes:
        - email
      AdminCreateUserConfig:
        AllowAdminCreateUserOnly: false

  UserPoolClient:
      Type: AWS::Cognito::UserPoolClient
      Properties:
        UserPoolId: !Ref CognitoUserPool
        ClientName: frontend-client
        GenerateSecret: false

Outputs:
  CognitoUserPool:
    Description: The DNSName of the backup load balancer
    Value: !Ref CognitoUserPool
      



  